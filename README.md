# 双向交流软件 (聊天室)

这是一个基于C语言和Socket编程的双向交流软件，支持多个客户端同时在线聊天。

## 项目特性

- 🌐 基于TCP Socket的网络通信
- 🔀 多线程支持，实现真正的双向通信
- 👥 支持多个客户端同时在线聊天
- 💬 实时消息广播
- 🚪 优雅的用户进入/离开提示
- 🛡️ 基本的错误处理和连接管理
- ⏰ **新功能**：每条消息显示时间戳
- 🎨 **新功能**：聊天界面左右分布（自己的消息在左，别人的在右）
- 🌈 **新功能**：彩色显示区分不同用户的消息

## 文件结构

```
teamwork/
├── server.c          # 服务器端代码
├── client.c          # 客户端代码
├── README.md          # 项目说明文档
├── Makefile          # 编译文件
└── run_demo.sh       # 演示脚本
```

## 编译方法

### 方法1: 手动编译
```bash
# 编译服务器
gcc -g -Wall -pthread -o server server.c

# 编译客户端
gcc -g -Wall -pthread -o client client.c
```

### 方法2: 使用Makefile
```bash
make all           # 编译服务器和客户端
make clean         # 清理编译文件
```

## 使用方法

### 1. 启动服务器
```bash
./server
```
服务器将监听8888端口，等待客户端连接。

### 2. 启动客户端
在新的终端窗口中运行：
```bash
./client <服务器IP地址>
```

例如：
```bash
./client 127.0.0.1      # 连接本地服务器
./client 192.168.1.100  # 连接远程服务器
```

### 3. 开始聊天
- 启动客户端后，输入您的用户名
- 开始输入消息进行聊天
- 输入 `exit` 退出聊天室
- 使用 `Ctrl+C` 也可以退出

## 演示步骤

1. **启动服务器**：
   ```bash
   ./server
   ```

2. **启动多个客户端**（每个在新终端）：
   ```bash
   # 终端2
   ./client 127.0.0.1
   
   # 终端3  
   ./client 127.0.0.1
   ```

3. **进行聊天测试**：
   - 在不同客户端输入消息
   - 观察消息在所有客户端的实时显示
   - 测试用户进入/离开提示

## 技术要点

### 服务器端 (server.c)
- **Socket创建**：使用 `socket()` 创建TCP套接字
- **地址绑定**：使用 `bind()` 绑定地址和端口
- **监听连接**：使用 `listen()` 监听客户端连接
- **接受连接**：使用 `accept()` 接受客户端连接
- **多线程处理**：为每个客户端创建独立线程
- **线程同步**：使用互斥锁保护共享资源
- **消息广播**：向所有在线客户端转发消息

### 客户端 (client.c)
- **服务器连接**：使用 `connect()` 连接到服务器
- **双线程设计**：
  - **发送线程**：读取用户输入并发送到服务器
  - **接收线程**：接收并显示来自服务器的消息
- **信号处理**：捕获Ctrl+C信号实现优雅退出
- **用户界面**：简洁的命令行交互界面

### 核心技术
1. **Socket编程**：TCP套接字通信
2. **多线程编程**：pthread库的使用
3. **线程同步**：互斥锁（mutex）防止竞态条件
4. **信号处理**：优雅处理程序退出
5. **字符串处理**：消息格式化和解析
6. **内存管理**：动态内存分配和释放

## 程序流程

### 服务器流程
1. 创建并配置套接字
2. 绑定地址和端口
3. 开始监听客户端连接
4. 接受客户端连接，为每个客户端创建线程
5. 在线程中处理客户端消息并广播

### 客户端流程
1. 连接到服务器
2. 发送用户名
3. 创建发送和接收线程
4. 发送线程处理用户输入
5. 接收线程显示服务器消息

## 扩展功能建议

1. **私聊功能**：添加@用户名的私聊功能
2. **文件传输**：支持发送文件
3. **聊天记录**：保存聊天历史到文件
4. **用户列表**：显示在线用户列表
5. **房间系统**：支持多个聊天房间
6. **加密通信**：添加消息加密功能
7. **心跳检测**：检测客户端连接状态
8. **消息时间戳**：显示消息发送时间

## 注意事项

- 确保防火墙允许8888端口通信
- 服务器需要先于客户端启动
- 网络环境需要支持TCP连接
- 多个客户端需要使用不同的终端窗口
- 程序使用UTF-8编码，支持中文显示

## 常见问题

**Q: 编译时出现pthread相关错误？**
A: 确保添加 `-pthread` 编译选项

**Q: 客户端无法连接服务器？**
A: 检查服务器是否启动，IP地址是否正确，防火墙设置

**Q: 消息显示乱码？**
A: 确保终端支持UTF-8编码

## 学习价值

这个项目非常适合Linux编程实训，涵盖了：
- Socket网络编程基础
- 多线程并发编程
- 线程同步机制
- 系统调用的使用
- C语言项目组织
- Makefile的编写

通过这个项目，学生可以深入理解Linux网络编程的核心概念和实践技巧！
