# 聊天室系统使用说明

## 项目简介

这是一个基于C语言和Socket编程的多用户聊天室系统，支持用户注册、登录和实时聊天功能。

## 使用方法

### 编译程序

```bash
# 编译服务端和客户端
make

# 只编译服务端
make server

# 只编译客户端
make client
```

### 启动服务端

```bash
# 本地启动服务端
./chat_server
```

### 启动客户端

```bash
# 连接到本地服务器(127.0.0.1)
./chat_client

# 连接到指定IP地址的服务器
./chat_client 192.168.1.100

# 使用便捷脚本
./start_client.sh          # 连接到本地服务器
./start_client.sh 10.0.0.5 # 连接到指定IP的服务器
```

### 使用帮助

```bash
# 显示帮助信息
./chat_client -h
./chat_client --help
```

## 重要特性

### 🔑 用户体验优化
- **清晰的消息显示**：玩家只会看到格式化的消息 `[时间] 用户名: 消息内容`
- **无重复显示**：发送者不会看到自己的消息回显，避免混乱
- **自动换行**：长消息自动在合适位置换行（每行最多80字符）
- **实时接收**：新消息立即显示，输入提示符自动更新

### 🌐 网络功能
- 支持命令行参数指定服务器IP
- 实时消息传递
- 多客户端同时连接
- 用户在线状态通知

## 文件说明

### 核心文件
- `chat_server.c` - 聊天服务端源代码
- `chat_client.c` - 聊天客户端源代码  
- `Makefile` - 编译配置文件

### 辅助文件
- `start_client.sh` - 便捷客户端启动脚本，支持IP参数
- `deploy_server.sh` - 服务器部署脚本
- `SERVER_DEPLOYMENT.md` - 服务器部署说明

## 远程部署

如需将服务器部署到远程服务器，请参考 `SERVER_DEPLOYMENT.md` 文件。

## 登录信息

系统默认管理员账户：
- 用户名: admin
- 密码: Admin123

## 常见问题

1. **无法连接到服务器**
   - 确认服务器已启动
   - 检查IP地址是否正确
   - 确认服务器防火墙允许8888端口的TCP连接

2. **消息不显示**
   - 确认您已成功登录
   - 检查网络连接是否稳定

3. **如何退出程序**
   - 按 Ctrl+C 可以安全退出客户端
- `guide.sh` - 使用指南（运行此脚本查看帮助）
- `README.md` - 详细说明文档
- `PROJECT_SUMMARY.md` - 项目总结文档

### 生成文件
- `chat_server` - 编译后的服务端可执行文件
- `chat_client` - 编译后的客户端可执行文件
- `users.dat` - 用户数据文件（自动生成）

## 功能特性

### 服务端功能
- 支持多客户端并发连接（最大10个）
- 用户注册和登录认证
- 消息广播和历史记录
- 用户数据持久化存储
- 线程安全的客户端管理

### 客户端功能
- 图形化登录/注册菜单
- 实时消息接收和发送
- 自动换行显示（每行最多80字符）
- 清晰的消息格式：[时间] 用户名: 消息内容
- 优雅的输入体验

### 消息格式
- **用户消息**：`[HH:MM:SS] 用户名: 消息内容`
- **系统消息**：`[HH:MM:SS] >>> 系统提示`
- **历史记录**：`[HH:MM:SS] >>> 以下是最近的聊天记录 <<<`
- 支持中文和英文混合显示
- 长消息自动在空格、标点处换行
- 每行最多80字符，确保良好的显示效果

### 用户体验设计
1. **输入隔离**：用户输入的原始文本不会显示在聊天区域
2. **消息过滤**：发送者不会看到自己消息的回显
3. **清晰分离**：只显示 `[时间] 用户名: 内容` 格式的消息
4. **实时更新**：新消息到达时自动清除输入行并重新显示提示符

## 快速开始

### 🚀 一键测试
```bash
# 最简单的方式 - 使用启动脚本
./start.sh
# 选择选项3：同时启动服务端和客户端

# 或者使用测试脚本
./test.sh
# 然后在另一个终端运行 ./chat_client
```

### 📝 手动步骤
```bash
# 1. 编译程序
make all

# 2. 启动服务端（终端1）
./chat_server

# 3. 启动客户端（终端2）
./chat_client

# 4. 注册/登录后开始聊天
```

## 编译和运行

### 1. 编译程序

```bash
# 编译所有程序
make all

# 或者分别编译
make server  # 编译服务端
make client  # 编译客户端
```

### 2. 运行服务端

```bash
# 方法1：使用make运行
make run-server

# 方法2：直接运行
./chat_server
```

服务端启动后会显示：
```
=== 聊天服务器启动 ===
监听端口: 8888
最大客户端数: 10
用户数据库: 1 个用户
等待客户端连接...
```

### 3. 运行客户端

```bash
# 方法1：使用make运行
make run-client

# 方法2：直接运行
./chat_client
```

客户端启动后会显示登录菜单：
```
╔══════════════════════════════════════════════╗
║              聊天室客户端                    ║
║                                              ║
║   [1] 登录                                   ║
║   [2] 注册                                   ║
║   [3] 退出                                   ║
║                                              ║
╚══════════════════════════════════════════════╝
请选择操作: 
```

## 使用指南

### 1. 首次使用 - 注册账户

1. 运行客户端，选择 `[2] 注册`
2. 输入用户名（3-20字符，字母开头）
3. 输入密码（6-50字符，需包含大小写字母、数字中至少两种）
4. 输入邮箱地址
5. 注册成功后返回主菜单

### 2. 登录聊天

1. 选择 `[1] 登录`
2. 输入用户名和密码
3. 登录成功后进入聊天界面
4. 可以看到历史聊天记录
5. 直接输入消息并按回车发送

### 3. 默认管理员账户

系统提供默认管理员账户：
- 用户名：`admin`
- 密码：`Admin123`

### 4. 聊天操作

- **发送消息**：直接输入文本按回车
- **查看历史**：登录后自动显示最近30条消息
- **退出聊天**：按 `Ctrl+C` 退出

## 技术细节

### 网络配置
- 服务端端口：8888
- 服务器IP：127.0.0.1（本地）
- 协议：TCP

### 用户验证规则
- **用户名**：3-20字符，必须字母开头，只能包含字母、数字、下划线
- **密码**：6-50字符，必须包含大小写字母、数字中的至少两种
- **邮箱**：标准邮箱格式验证

### 数据存储
- 用户数据保存在 `users.dat` 文件中
- 支持最多1000个用户
- 历史消息保存最近30条

## 故障排除

### 常见问题

1. **编译错误**
   ```bash
   # 确保安装了gcc和必要的库
   sudo apt-get install gcc libc6-dev
   ```

2. **连接失败**
   - 确保服务端已启动
   - 检查防火墙设置
   - 确认端口8888未被占用

3. **权限问题**
   ```bash
   # 给予执行权限
   chmod +x chat_server chat_client
   ```

4. **端口占用**
   ```bash
   # 查看端口使用情况
   netstat -tlnp | grep 8888
   
   # 杀死占用进程
   sudo kill -9 <PID>
   ```

### 清理文件

```bash
# 清理编译文件和用户数据
make clean
```

## 系统要求

- Linux 操作系统
- GCC 编译器
- POSIX 线程库（pthread）
- 网络支持

## 注意事项

1. 服务端必须先启动，客户端才能连接
2. 最多支持10个客户端同时在线
3. 消息长度限制为1024字符
4. 系统自动保存用户数据，重启后数据不丢失
5. 客户端异常退出时服务端会自动清理连接

## 扩展功能

可以考虑的扩展功能：
- 私聊功能
- 房间/频道系统
- 文件传输
- 用户权限管理
- Web界面
- 消息加密

---

如有问题，请检查编译输出和运行日志。
